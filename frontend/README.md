# POG-Coin: Smart contract & frontend

Guide here: https://www.youtube.com/watch?v=a0osIaAOFSE (recommend watching the entire thing on 1.5x)
Hardhat is a standard Ethereum development environment, and allows you to run Solidity locally (all the hardhat commands below have details at https://hardhat.org/hardhat-network/)

```shell
# Pls ensure your Node.js is on v14.17.5 (the current latest LTS). This will hopefully avoid random dependency conflicts down the road
nvm install v14.17.5
# Sets default Node to this new version
nvm alias default node
PATH should contain something like this: ~/.nvm/versions/node/v14.17.5/bin
```

```shell
npm install

# Compiles .sol contracts i.e. places the json ABI in the src/artifacts/contracts folder
npx hardhat compile

# Note: BOTH of the below need to be running (different tabs) 
# (https://www.youtube.com/watch?v=a0osIaAOFSE&t=680s)
# Note 2: Don't navigate to the browser for the first one as it gives a meaningless jsonrpc error
# Start Hardhat Network 
# Can take Account #0 generated by this command and import the account to Metamask (localhost network)
npx hardhat node
# Deploy (compiled) contracts to above network.
# This prints out the address of SimpleToken. Use it when creating/testing deals locally.
npx hardhat run scripts/deploy.js --network localhost

# Follow the hardhat setup here: https://docs.moralis.io/moralis-server/web3/setting-up-ganache
# Use the following command after you set up your dev env:
./frpc -c frpc.ini

# IMPORTANT: make sure to run this command to set up your firebase env. Run it after you deploy the contracts with scripts/deploy.js. Example collection-name is dummy-local
# If you get a permissions error, update the permissions in the Firestore db (in the Rules tab)
npx hardhat updateFirebaseState --collection <collection-name> --network localhost

# Run our application on localhost
npm start

# Run tests
npx hardhat test


# Print state of a specific deal
npx hardhat printDealState --address 0xbf9fBFf01664500A33080Da5d437028b07DFcC55 --network localhost

# Print state of all our deals
npx hardhat printState --network localhost
```

## Testing

1. Log into metamask
2. Set metamask eth network to Localhost 8545
3. Make sure you are on one of the 20 accounts listed when you ran "npx hardhat node"
4. Go to Settings -> Advanced -> Reset Account if necessary
5. Go to the Create a Deal form and create a deal. Use the startup token address listed when you ran scripts/deploy.js

## Roadmap
https://app.asana.com/0/1200947132958937/board

## Hosting on Firebase
```
# Configure for testnet deployment
npx hardhat configureForTestnet

npm run build
firebase emulators:start // Test on local machine
firebase deploy --only hosting // Deploy live
firebase hosting:channel:deploy CHANNEL_ID // Deploy to a preview url
```

## Troubleshooting
If you try to fetch greeting in the UI and see:
1. Nonce too high. Expected nonce to be 0 but got 1. Note that transactions can't be queued when automining. ==> Go to your metamask wallet -> Settings -> Advanced -> Reset account
2. But bottom line make sure the token address in App.js matches what you last deployed
3. RPC Error: Error: [ethjs-query] while formatting outputs from RPC '{"value":{"code":-32603,"data":{"code":-32000,"message":"Nonce too high. Expected nonce to be 2 but got 10. Note that transactions can't be queued when automining."}}}' ==> Go to MetaMask advanced settings and reset account (https://dev.to/nmassi/comment/1dafo)

